<!-- -->

<!DOCTYPE html>
<html lang="en
"  prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml" >

  <head>
    <title>
When Coding, Write in Stages
  -
  Dylan Gregersen
    </title>

    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon  <link rel="apple-touch-icon" sizes="120x120" href="/static/img/favicon/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon/favicon-16x16.png"> <link rel="manifest" href="/static/img/favicon/site.webmanifest"> <link rel="mask-icon" href="/static/img/favicon/safari-pinned-tab.svg" color="#ffffff"> <meta name="msapplication-TileColor" content="#ffffff"> <meta name="theme-color" content="#ffffff"> -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">

    <!-- if -->
  <link rel="canonical" href="/blog/astronomy/2014/10/when-coding-write-in-stages"/>

    <!-- if -->
  <!-- if -->

    <meta name="author" content="Dylan Gregersen"/>

  <!-- if -->

    <meta name="keywords" content="python,interactive,research,tips-n-tricks"/>

  <!-- if -->

    <meta name="description" content="Basically it&#39;s best to write code which will execute in stages"/>

    <!-- if -->
  <!-- if -->

    <meta property="og:site_name" content="Dylan Gregersen"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="When Coding, Write in Stages"/>
    <meta property="og:url" content="/blog/astronomy/2014/10/when-coding-write-in-stages"/>
    <meta property="og:description" content="Basically it&#39;s best to write code which will execute in stages"/>
    <meta property="article:published_time" content='2014-10-29'/>
      <meta property="article:section" content="Astronomy"/>
      <meta property="article:tag" content="python"/>
      <meta property="article:tag" content="interactive"/>
      <meta property="article:tag" content="research"/>
      <meta property="article:tag" content="tips-n-tricks"/>
      <meta property="article:author" content="Dylan Gregersen"/>

    <!-- if -->

    <!-- if -->

    <!-- Bootstrap -->
      <link rel="stylesheet" href="/static/css/bootstrap.journal.min.css" type="text/css"/>
    <link href="/static/css/pygments/native.css" rel="stylesheet">

    <!-- -->

    <!-- -->

    <!-- Typogrify -->
    <link href="/static/css/font-awesome.min.css" rel="stylesheet">
    <link href="/static/css/typogrify.css" rel="stylesheet">

    <!-- -->
    <link rel="stylesheet" href="/static/css/style.css" type="text/css"/>

    <!-- -->
      <link href="/static/css/global.css" rel="stylesheet">

    <!-- -->

    <!-- -->

    <!-- -->
      <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Dylan Gregersen ATOM Feed"/>

    <!-- -->

    <!-- -->

    <!-- -->
      <!-- -->
        <!-- -->
      <link href="/feeds/astronomy.atom.xml" type="application/atom+xml" rel="alternate" title="Dylan Gregersen Astronomy ATOM Feed"/>
      <!-- -->
  </head>

  <body>
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          <a href="/" class="navbar-brand">
Dylan Gregersen
          </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
          <ul class="nav navbar-nav">
              <li>
                <a href="/research">Research</a>
              </li>
              <li>
                <a href="/about">About</a>
              </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
          </ul>
        </div>
        <!-- /.navbar-collapse -->
      </div>
    </div>
    <!-- /.navbar -->

    <!-- Banner -->
    <div class="container-fluid">
    </div>
    <!-- End Banner -->

    <!-- Content Container -->
    <div class="container-fluid">
      <!--  -->
  <section class="article-container">
    <div class="col-sm-3" id="sidebar">
<div class="thumbnail">
  <p>
    <em>"You are something the whole Universe is doing, the same way a wave is something the whole ocean is doing"</em>
    â€• Alan W. Watts
  </p>
  <img src="https://earthastronaut.s3.amazonaws.com/profile_photos/dylan_gregersen_paddling.jpg" class="img-rounded" alt="Photo">
  <div class="caption">
    Problem Solver, Python Programmer, Data Scientist, Mentor, Muscian, and Vegan.
    <h4>
      <a href="https://github.com/earthastronaut"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a>
      <a href="https://www.linkedin.com/in/dylangregersen"><svg viewBox="64 64 896 896" focusable="false" data-icon="linkedin" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M847.7 112H176.3c-35.5 0-64.3 28.8-64.3 64.3v671.4c0 35.5 28.8 64.3 64.3 64.3h671.4c35.5 0 64.3-28.8 64.3-64.3V176.3c0-35.5-28.8-64.3-64.3-64.3zm0 736c-447.8-.1-671.7-.2-671.7-.3.1-447.8.2-671.7.3-671.7 447.8.1 671.7.2 671.7.3-.1 447.8-.2 671.7-.3 671.7zM230.6 411.9h118.7v381.8H230.6zm59.4-52.2c37.9 0 68.8-30.8 68.8-68.8a68.8 68.8 0 10-137.6 0c-.1 38 30.7 68.8 68.8 68.8zm252.3 245.1c0-49.8 9.5-98 71.2-98 60.8 0 61.7 56.9 61.7 101.2v185.7h118.6V584.3c0-102.8-22.2-181.9-142.3-181.9-57.7 0-96.4 31.7-112.3 61.7h-1.6v-52.2H423.7v381.8h118.6V604.8z"></path></svg></a>
    </h4>
  </div>
</div>    </div>
    <div class="col-sm-9" id="content">
      <article>
        <header class="page-header">
          <h1>
            <a href="/blog/astronomy/2014/10/when-coding-write-in-stages" rel="bookmark" title="Permalink to When Coding, Write in Stages">
              When Coding, Write in Stages
            </a>
          </h1>
        </header>
        <div class="entry-content">
          <div class="panel">
            <div class="panel-body"><!-- -->

<footer class="post-info">
  <div class="container">
  <div class="row">
    <div class="col-sm-1" style="text-align:right;">
      <strong>Date</strong>
    </div>
    <div class="col-sm-6">    <time datetime="2014-10-29T11:42:19-06:00">Wed 29 October 2014</time>
</div>
    <div class="col-sm-6"></div>
  </div>

  <!-- -->




  <div class="row">
    <div class="col-sm-1" style="text-align:right;">
      <strong>Tags</strong>
    </div>
    <div class="col-sm-6">        <a href="/tag/python.html">python</a>
          ,
        <a href="/tag/interactive.html">interactive</a>
          ,
        <a href="/tag/research.html">research</a>
          ,
        <a href="/tag/tips-n-tricks.html">tips-n-tricks</a>
</div>
    <div class="col-sm-6"></div>
  </div>

  <!-- -->


  </div>
</footer></div>
          </div>
          <p>Basically this post is about caching your results as you go. Why it's a fantasitic idea and how I do it. </p>
<p>This was a lesson I learned while writing scripts for my Astronomy research. I like to have all my code for a particular task in one script. I haven't really given up on that because I think it's good to have all the logic in one place. However, I learned the importance of coding in stages so that I don't have to continually re-run code which takes a long time. </p>
<h1>Working in Stages</h1>
<p>Don't write one code which runs from start to finish. Segment your code into functions and sections which can be run one at a time.</p>
<p>Here's an example. I have a script which processes some data and makes plots of it. The "bad" way is to write a script which generates goes back and forth running processing steps (which take a while) and adding data to my plots. </p>
<p>I have some function which generates data to plot. This function takes, say an hour to run. Then I make a plot with the data. Often these two tasks are lumped together (cause it makes logical sense) but from the CS viewpoint this makes the process harder. Say you want to change parameters of the plot or there's an error in your plotting. Then you must re-run the entire code just to fix those minor bugs.</p>
<h3>Solution 1: Make two scripts</h3>
<p>Make two scripts. One which generates the data and saves to file. Another which reads the data and makes a plot. </p>
<h3>Solution 2: Cache Results in Memory</h3>
<p>I still like to have all my code together in one script so I break up my code into two functions: One which generates the data; another which plots it.</p>
<p>In a script (example.py) I have the two lines:
    data = function(input)
    plot_data(data,filename_out)</p>
<p>Then I use execfile to execute interactively
    &gt;&gt;&gt; execfile("example.py")
    &gt;&gt;&gt; </p>
<p>To re-run and just make the plot I comment the data line out and re-execute in the open terminal.
    # data = function(input)
    plot_data(data,filename_out)</p>
<p>This method works because I don't close the python terminal. I'm using it interactively so the terminal still knows what 'data' means and keeps it all around in memory. The same works for this:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="s1">&#39;startup&#39;</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">globals</span><span class="ss">()</span>:<span class="w"></span>
<span class="w">    </span>...<span class="w"></span>
<span class="w">    </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">function</span><span class="ss">(</span><span class="nv">input</span><span class="ss">)</span><span class="w"></span>
<span class="w">    </span>...<span class="w"></span>
<span class="w">    </span><span class="nv">startup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">True</span><span class="w"></span>
<span class="nv">plot_data</span><span class="ss">(</span><span class="nv">data</span>,<span class="nv">filename_out</span><span class="ss">)</span><span class="w"></span>
</code></pre></div>

<p>The variable <code>startup</code> lets the code know that that block has been run in the current terminal and all the names are saved in the current session.</p>
<h3>Solution 3: Use a Function Cacher</h3>
<p>Allow the function or some object to store the results of running something long and interactive.</p>
<h2>Python 3</h2>
<p>Of the changes in Python 3 the one which caused the most distruption to this workflow is the removal of <code>execfile</code>. Many posts exist on how to backport <code>execfile</code> though I found most didn't work well. This method did, and I've added it to my <a href="https://docs.python.org/2/using/cmdline.html#envvar-PYTHONSTARTUP">python startup file</a>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">PY3</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span>
<span class="k">if</span> <span class="n">PY3</span><span class="p">:</span> 
    <span class="c1"># backport of execfile</span>
    <span class="k">def</span> <span class="nf">execfile</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span>  <span class="nb">globals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">locals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">globals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">globals</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_globals</span>
        <span class="k">if</span> <span class="nb">locals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">locals</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># import runpy</span>
            <span class="c1"># result = runpy.run_path(f,globals,locals)</span>
            <span class="c1"># globals.update(result) ??  </span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">),</span><span class="s1">&#39;exec&#39;</span><span class="p">)</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span><span class="nb">globals</span><span class="p">,</span><span class="nb">locals</span><span class="p">)</span>
    <span class="c1"># backport of reload       </span>
    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="n">some_module</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">importlib</span> <span class="k">as</span> <span class="nn">imp</span>
        <span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">some_module</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">some_module</span><span class="p">)</span>
</code></pre></div>

<p>Note the reason <code>execfile</code> was deprecated is because it's not the correct thing to use to incorporate other code into your scripts. I.e. In a script never do:</p>
<div class="highlight"><pre><span></span><code>...
execfile(&quot;other_script.py&quot;)
...
</code></pre></div>

<p>Always use <code>import other_script</code>. If you change something in 'other_script' you'll need to <code>reload(other_script)</code>.</p>
        </div>
        <!-- /.entry-content -->
<footer>
  <hr>
  <div class="row">
    <div>&copy;
      2014
      Dylan Gregersen
    </div>
    <div>
      <p>
        <i class="fa fa-arrow-up"></i>
        <a href="#">Back to top</a>
      </p>
    </div>
  </div>
</footer>      </article>
    </div>
  </section>

    </div>

    <!-- End Content Container -->

    <!-- scripts -->
    <div class="container-fluid">
      <script src="/static/js/jquery.min.js"></script>

      <!-- Include all compiled plugins (below), or include individual files as needed -->
      <script src="/static/js/bootstrap.min.js"></script>

      <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
      <script src="/static/js/respond.min.js"></script>



      <!-- include -->
      <!-- include -->
      <!-- include -->
      <!-- include -->


    </div>
  </body>

</html>